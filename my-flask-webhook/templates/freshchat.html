{% extends "base.html" %}
{% block content %}
  <h1>Freshchat Integration</h1>
  
  <div class="card">
    <h3>Configuration</h3>
    <p>FRESHCHAT_BASE_URL: <span class="status {{ 'ok' if freshchat_base_url else 'warn' }}">{{ freshchat_base_url or 'Not set' }}</span></p>
    <p>FRESHCHAT_TOKEN: <span class="status {{ 'ok' if has_freshchat_token else 'warn' }}">{{ 'Set' if has_freshchat_token else 'Not set' }}</span></p>
    <p>FRESHCHAT_PUBLIC_KEY_PEM: <span class="status {{ 'ok' if has_freshchat_public_key else 'warn' }}">{{ 'Set (éªŒè¯å·²å¯ç”¨)' if has_freshchat_public_key else 'Not set (è·³è¿‡ç­¾åéªŒè¯)' }}</span></p>
  </div>

  <div class="card">
    <h3>ğŸ”— Webhook URL</h3>
    <p>åœ¨ Freshchat åå°é…ç½®æ­¤ Webhook URLï¼š</p>
    <pre style="background: #2c3e50; color: #ecf0f1; padding: 12px; border-radius: 4px; overflow-x: auto;">https://your-domain.com/freshchat-webhook</pre>
    <p class="meta">æœ¬åœ°æµ‹è¯•: http://localhost:5001/freshchat-webhook</p>
    <p class="meta">éœ€è¦è®¢é˜…çš„äº‹ä»¶: <code>message_create</code></p>
  </div>

  <div class="card">
    <h3>ğŸ“‹ å·¥ä½œæµç¨‹</h3>
    <ol style="line-height: 1.8;">
      <li>ç”¨æˆ·åœ¨ Freshchat å‘é€æ¶ˆæ¯</li>
      <li>Freshchat æ¨é€ webhook åˆ° <code>/freshchat-webhook</code></li>
      <li>ç³»ç»Ÿè°ƒç”¨ GPTBots Agent API è·å– AI å›å¤</li>
      <li>ç³»ç»Ÿå°† AI å›å¤å‘é€å› Freshchat</li>
      <li>ç”¨æˆ·åœ¨ Freshchat ä¸­çœ‹åˆ° AI å›å¤</li>
    </ol>
  </div>

  <div class="card">
    <h3>ğŸ§ª æµ‹è¯•æ¨¡æ‹Ÿ Webhook</h3>
    <form method="post" action="/freshchat/test">
      <label for="test_message">æ¨¡æ‹Ÿç”¨æˆ·æ¶ˆæ¯</label>
      <textarea id="test_message" name="message" placeholder="è¾“å…¥æµ‹è¯•æ¶ˆæ¯">ä½ å¥½</textarea>
      <label for="test_conversation_id" style="margin-top: 12px;">Freshchat Conversation ID (å¯é€‰)</label>
      <input type="text" id="test_conversation_id" name="conversation_id" placeholder="ç•™ç©ºä½¿ç”¨æµ‹è¯• ID">
      <label for="test_user_id" style="margin-top: 12px;">User ID (å¯é€‰)</label>
      <input type="text" id="test_user_id" name="user_id" placeholder="ç•™ç©ºä½¿ç”¨æµ‹è¯• ID">
      <div style="margin-top: 12px;">
        <button type="submit">æµ‹è¯• AI å›å¤</button>
      </div>
    </form>
  </div>

  {% if test_result %}
  <div class="card">
    <h3>ğŸ§ª æµ‹è¯•ç»“æœ</h3>
    <pre>{{ test_result | tojson(indent=2) }}</pre>
  </div>
  {% endif %}

  <div class="card">
    <h3>ğŸ’¡ æ³¨æ„äº‹é¡¹</h3>
    <ul style="line-height: 1.8;">
      <li>ç¡®ä¿ GPTBots Agent API å·²å¯ç”¨</li>
      <li>Freshchat Token éœ€è¦æœ‰å‘é€æ¶ˆæ¯çš„æƒé™</li>
      <li>å¦‚æœæœªé…ç½® Public Keyï¼Œç­¾åéªŒè¯ä¼šè¢«è·³è¿‡ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰</li>
      <li>ç”Ÿäº§ç¯å¢ƒå»ºè®®å¯ç”¨ç­¾åéªŒè¯ä»¥ç¡®ä¿å®‰å…¨</li>
      <li>æŸ¥çœ‹ <a href="/webhooks" style="color: #3498db;">Webhook æ—¥å¿—</a> äº†è§£è¯¦ç»†çš„è¯·æ±‚ä¿¡æ¯</li>
    </ul>
  </div>
{% endblock %}
