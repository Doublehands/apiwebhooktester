{% extends "base.html" %}
{% block content %}
  <h1>ğŸ’¬ Live Chat Test</h1>
  
  <div class="card">
    <h3>å®æ—¶èŠå¤©æµ‹è¯•</h3>
    <p>è¿™ä¸ªé¡µé¢åµŒå…¥äº† Freshchat èŠå¤©æ°”æ³¡ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨è¿™é‡Œæµ‹è¯•çœŸå®çš„å¯¹è¯æµç¨‹ã€‚</p>
    <p class="meta">ç‚¹å‡»å³ä¸‹è§’çš„èŠå¤©æ°”æ³¡å¼€å§‹å¯¹è¯</p>
  </div>

  <div class="card">
    <h3>ğŸ“‹ æµ‹è¯•æµç¨‹</h3>
    <ol style="line-height: 1.8;">
      <li>ç‚¹å‡»é¡µé¢å³ä¸‹è§’çš„èŠå¤©æ°”æ³¡</li>
      <li>åœ¨èŠå¤©çª—å£ä¸­å‘é€æ¶ˆæ¯</li>
      <li>æ¶ˆæ¯ä¼šå‘é€åˆ° Freshchat</li>
      <li>Freshchat è§¦å‘ webhook åˆ°æœ¬æœåŠ¡</li>
      <li>æœåŠ¡è°ƒç”¨ GPTBots Agent è·å– AI å›å¤</li>
      <li>AI å›å¤é€šè¿‡ Freshchat API å‘é€å›èŠå¤©çª—å£</li>
      <li>ä½ ä¼šåœ¨èŠå¤©çª—å£çœ‹åˆ° AI çš„å›å¤</li>
    </ol>
  </div>

  <div class="card">
    <h3>ğŸ” è°ƒè¯•ä¿¡æ¯</h3>
    <p>æŸ¥çœ‹è¯¦ç»†çš„ webhook æ—¥å¿—ï¼š<a href="/webhooks" style="color: #3498db;">Webhook æ—¥å¿—é¡µé¢</a></p>
    <p class="meta">æ¯æ¬¡å¯¹è¯éƒ½ä¼šåœ¨æ—¥å¿—ä¸­è®°å½•å®Œæ•´çš„è¯·æ±‚å’Œå“åº”ä¿¡æ¯</p>
  </div>

  <div class="card">
    <h3>âš ï¸ æ³¨æ„äº‹é¡¹</h3>
    <ul style="line-height: 1.8;">
      <li><strong>æœ¬åœ°æµ‹è¯•é™åˆ¶</strong>ï¼šFreshchat æ— æ³•ç›´æ¥è®¿é—® localhostï¼Œéœ€è¦ä½¿ç”¨å†…ç½‘ç©¿é€å·¥å…·ï¼ˆå¦‚ ngrokï¼‰</li>
      <li><strong>Webhook é…ç½®</strong>ï¼šç¡®ä¿åœ¨ Freshchat åå°é…ç½®äº†æ­£ç¡®çš„ webhook URL</li>
      <li><strong>API çŠ¶æ€</strong>ï¼šç¡®ä¿ GPTBots Agent API å·²å¯ç”¨</li>
    </ul>
  </div>

  <div class="card" style="background: #fff3cd; border-left: 4px solid #ffc107;">
    <h3>ğŸš€ ä½¿ç”¨ ngrok è¿›è¡Œæœ¬åœ°æµ‹è¯•</h3>
    <p>ç”±äº Freshchat éœ€è¦å…¬ç½‘ URLï¼Œä½ éœ€è¦ä½¿ç”¨ ngrok å°†æœ¬åœ°æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ï¼š</p>
    <pre style="background: #2c3e50; color: #ecf0f1; padding: 12px; border-radius: 4px; overflow-x: auto;">
# 1. å®‰è£… ngrok (å¦‚æœè¿˜æ²¡å®‰è£…)
brew install ngrok

# 2. å¯åŠ¨ ngrok
ngrok http 5001

# 3. å¤åˆ¶ ngrok æä¾›çš„ HTTPS URLï¼Œä¾‹å¦‚ï¼š
# https://abc123.ngrok.io

# 4. åœ¨ Freshchat åå°é…ç½® Webhook URLï¼š
# https://abc123.ngrok.io/freshchat-webhook
    </pre>
  </div>

  <div class="card">
    <h3>ğŸ“Š å®æ—¶çŠ¶æ€</h3>
    <p>Agent API: <span class="status {{ 'ok' if agent_configured else 'warn' }}">{{ 'Ready' if agent_configured else 'Not Configured' }}</span></p>
    <p>Freshchat API: <span class="status {{ 'ok' if freshchat_configured else 'warn' }}">{{ 'Ready' if freshchat_configured else 'Not Configured' }}</span></p>
    <p>Webhook Endpoint: <span class="status ok">/freshchat-webhook</span></p>
  </div>

{% endblock %}

{% block extra_scripts %}
<!-- Freshchat Widget -->
<script
  src='//au.fw-cdn.com/20961549/381095.js'
  chat='true'>
</script>

<style>
  /* ç¡®ä¿èŠå¤©æ°”æ³¡åœ¨é¡µé¢ä¸Šå¯è§ */
  #fc_frame {
    z-index: 9999 !important;
  }
</style>

<script>
  // å¯é€‰ï¼šç›‘å¬ Freshchat äº‹ä»¶
  window.fcWidget = window.fcWidget || {};
  
  // å½“èŠå¤©çª—å£æ‰“å¼€æ—¶
  window.fcWidget.on("widget:opened", function() {
    console.log("ğŸ’¬ Freshchat çª—å£å·²æ‰“å¼€");
  });
  
  // å½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶
  window.fcWidget.on("message:sent", function() {
    console.log("ğŸ“¤ æ¶ˆæ¯å·²å‘é€åˆ° Freshchat");
    console.log("â³ ç­‰å¾… AI å›å¤...");
  });
  
  // å½“æ”¶åˆ°æ–°æ¶ˆæ¯æ—¶
  window.fcWidget.on("message:received", function() {
    console.log("ğŸ“¥ æ”¶åˆ°æ–°æ¶ˆæ¯");
  });
</script>
{% endblock %}
