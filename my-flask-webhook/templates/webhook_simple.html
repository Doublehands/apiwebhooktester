<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webhook æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f7fb;
        }
        .card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1b1f23;
            margin-top: 0;
        }
        h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: #1b1f23;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            box-sizing: border-box;
            font-family: inherit;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
        }
        button:hover {
            background: #1d4ed8;
        }
        pre {
            background: #0f172a;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 14px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
        }
        .link {
            color: #2563eb;
            text-decoration: none;
        }
        .link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Webhook æµ‹è¯•å·¥å…·</h1>
    
    <div class="card">
        <h3>ğŸ“¡ Webhook ç«¯ç‚¹</h3>
        <pre>POST https://apiwebhooktester-z83n.vercel.app/freshchat-webhook</pre>
    </div>

    <div class="card">
        <h3>ğŸ§ª å‘é€æµ‹è¯• Webhook</h3>
        <form method="post" action="/webhook-test/send">
            <label for="conversation_id">Conversation ID</label>
            <input type="text" id="conversation_id" name="conversation_id" value="test_conv_12345" required>
            
            <label for="user_id" style="margin-top: 16px;">User ID</label>
            <input type="text" id="user_id" name="user_id" value="test_user_67890" required>
            
            <label for="message" style="margin-top: 16px;">æ¶ˆæ¯å†…å®¹</label>
            <textarea id="message" name="message" required>ä½ å¥½ï¼Œè¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯ï¼Œç”¨äºæµ‹è¯• conversation_id æå–</textarea>
            
            <div style="margin-top: 16px;">
                <button type="submit">ğŸš€ å‘é€æµ‹è¯• Webhook</button>
            </div>
        </form>
    </div>

    {% if test_result %}
    <div class="card">
        <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
        
        {% if test_result.success %}
        <div class="success">
            <strong>âœ… æµ‹è¯•æˆåŠŸï¼</strong>
            <p style="margin: 8px 0 0 0;">Webhook å·²æˆåŠŸæ¥æ”¶å¹¶å¤„ç†</p>
        </div>
        {% else %}
        <div class="error">
            <strong>âŒ æµ‹è¯•å¤±è´¥</strong>
            {% if test_result.error %}
            <p style="margin: 8px 0 0 0;">{{ test_result.error }}</p>
            {% endif %}
        </div>
        {% endif %}
        
        {% if test_result.webhook_response %}
        <div style="margin-top: 16px;">
            <strong>Webhook å“åº”:</strong>
            <pre>{{ test_result.webhook_response | tojson(indent=2) }}</pre>
        </div>
        {% endif %}
        
        <div style="margin-top: 16px;">
            <strong>å‘é€çš„æ•°æ®:</strong>
            <pre>{{ test_result.sent_data | tojson(indent=2) }}</pre>
        </div>
    </div>
    {% endif %}

    <div class="card">
        <h3>ğŸ“‹ ä½¿ç”¨ curl æµ‹è¯•</h3>
        <p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œæµ‹è¯•ï¼š</p>
        <pre>curl -X POST https://apiwebhooktester-z83n.vercel.app/freshchat-webhook \
  -H "Content-Type: application/json" \
  -d '{
    "action": "message_create",
    "data": {
      "message": {
        "actor_type": "user",
        "conversation_id": "test_conv_123",
        "user_id": "test_user_456",
        "message_parts": [
          {
            "text": {
              "content": "ä½ å¥½ï¼Œè¿™æ˜¯æµ‹è¯•æ¶ˆæ¯"
            }
          }
        ]
      }
    }
  }'</pre>
    </div>

    <div class="card">
        <h3>ğŸ“Š æŸ¥çœ‹è¯¦ç»†æ—¥å¿—</h3>
        <p>å‘é€æµ‹è¯•åï¼Œè®¿é—® <a href="/webhooks" class="link">Webhook æ—¥å¿—é¡µé¢</a> æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
        <p style="margin-top: 12px;">æ—¥å¿—ä¼šæ˜¾ç¤ºï¼š</p>
        <ul style="line-height: 1.8;">
            <li>âœ… æ¥æ”¶åˆ°çš„å®Œæ•´ webhook æ•°æ®</li>
            <li>âœ… æå–çš„ conversation_id å’Œ user_id</li>
            <li>âœ… ç”¨æˆ·æ¶ˆæ¯å†…å®¹</li>
            <li>âœ… AI å›å¤å†…å®¹</li>
            <li>âœ… å‘é€åˆ° Freshchat çš„ç»“æœ</li>
        </ul>
    </div>

    <div class="card">
        <h3>ğŸ  è¿”å›é¦–é¡µ</h3>
        <p><a href="/" class="link">â† è¿”å›é¦–é¡µ</a></p>
    </div>
</body>
</html>
