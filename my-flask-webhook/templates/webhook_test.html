{% extends "base.html" %}
{% block content %}
  <h1>ğŸ§ª Webhook æµ‹è¯•å·¥å…·</h1>
  
  <div class="card">
    <h3>ğŸ“¡ Webhook ç«¯ç‚¹</h3>
    <pre style="background: #2c3e50; color: #ecf0f1; padding: 12px; border-radius: 4px; overflow-x: auto;">POST https://apiwebhooktester-z83n.vercel.app/freshchat-webhook</pre>
  </div>

  <div class="card">
    <h3>ğŸ§ª æ¨¡æ‹Ÿ Freshchat Webhook</h3>
    <p>ä½¿ç”¨ä¸‹é¢çš„è¡¨å•å‘é€æµ‹è¯• webhook è¯·æ±‚</p>
    
    <form method="post" action="/webhook-test/send">
      <label for="conversation_id">Conversation ID</label>
      <input type="text" id="conversation_id" name="conversation_id" value="test_conv_12345" required>
      
      <label for="user_id" style="margin-top: 12px;">User ID</label>
      <input type="text" id="user_id" name="user_id" value="test_user_456" required>
      
      <label for="message" style="margin-top: 12px;">æ¶ˆæ¯å†…å®¹</label>
      <textarea id="message" name="message" placeholder="è¾“å…¥æµ‹è¯•æ¶ˆæ¯" required>ä½ å¥½ï¼Œè¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯</textarea>
      
      <div style="margin-top: 12px;">
        <button type="submit">å‘é€æµ‹è¯• Webhook</button>
      </div>
    </form>
  </div>

  {% if test_result %}
  <div class="card">
    <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
    <div style="margin-bottom: 16px;">
      <strong>çŠ¶æ€:</strong> 
      <span class="status {{ 'ok' if test_result.success else 'warn' }}">
        {{ 'âœ… æˆåŠŸ' if test_result.success else 'âŒ å¤±è´¥' }}
      </span>
    </div>
    
    {% if test_result.webhook_response %}
    <div style="margin-bottom: 16px;">
      <strong>Webhook å“åº”:</strong>
      <pre>{{ test_result.webhook_response | tojson(indent=2) }}</pre>
    </div>
    {% endif %}
    
    {% if test_result.error %}
    <div style="margin-bottom: 16px; color: #e74c3c;">
      <strong>é”™è¯¯ä¿¡æ¯:</strong>
      <pre>{{ test_result.error }}</pre>
    </div>
    {% endif %}
    
    <div>
      <strong>å‘é€çš„æ•°æ®:</strong>
      <pre>{{ test_result.sent_data | tojson(indent=2) }}</pre>
    </div>
  </div>
  {% endif %}

  <div class="card">
    <h3>ğŸ“‹ ä½¿ç”¨ curl æµ‹è¯•</h3>
    <p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ curl å‘½ä»¤æµ‹è¯• webhookï¼š</p>
    <pre style="background: #2c3e50; color: #ecf0f1; padding: 12px; border-radius: 4px; overflow-x: auto;">curl -X POST https://apiwebhooktester-z83n.vercel.app/freshchat-webhook \
  -H "Content-Type: application/json" \
  -d '{
    "action": "message_create",
    "data": {
      "message": {
        "actor_type": "user",
        "conversation_id": "test_conv_123",
        "user_id": "test_user_456",
        "message_parts": [
          {
            "text": {
              "content": "ä½ å¥½ï¼Œè¿™æ˜¯æµ‹è¯•æ¶ˆæ¯"
            }
          }
        ]
      }
    }
  }'</pre>
  </div>

  <div class="card">
    <h3>ğŸ“Š æŸ¥çœ‹æ—¥å¿—</h3>
    <p>å‘é€æµ‹è¯•åï¼Œè®¿é—® <a href="/webhooks" style="color: #3498db;">Webhook æ—¥å¿—é¡µé¢</a> æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
    <p class="meta">æ—¥å¿—ä¼šæ˜¾ç¤ºï¼š</p>
    <ul>
      <li>æ¥æ”¶åˆ°çš„å®Œæ•´ webhook æ•°æ®</li>
      <li>æå–çš„ conversation_id å’Œ user_id</li>
      <li>AI å›å¤å†…å®¹</li>
      <li>å‘é€åˆ° Freshchat çš„å“åº”</li>
    </ul>
  </div>

  <div class="card">
    <h3>ğŸ” Freshchat Webhook æ•°æ®æ ¼å¼</h3>
    <p>Freshchat å‘é€çš„ webhook æ•°æ®ç»“æ„ï¼š</p>
    <pre style="background: #f9fafb; padding: 12px; border-radius: 4px; overflow-x: auto;">{
  "action": "message_create",
  "data": {
    "message": {
      "actor_type": "user",
      "conversation_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
      "user_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
      "message_parts": [
        {
          "text": {
            "content": "ç”¨æˆ·æ¶ˆæ¯å†…å®¹"
          }
        }
      ],
      "created_time": "2026-01-22T10:30:00.000Z",
      ...
    }
  }
}</pre>
  </div>
{% endblock %}
